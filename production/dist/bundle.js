!function(e){var t={};function s(l){if(t[l])return t[l].exports;var o=t[l]={i:l,l:!1,exports:{}};return e[l].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,l){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(s.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(l,o,function(t){return e[t]}.bind(null,o));return l},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class l{getBombs(e,t,s){let l=[];for(let r=0;r<e;r++){let r=o(t*s);i(r,l)?l.push(r):e++}return l;function o(e){let t=0;return t=Math.random()*e,t=Math.floor(t)}function i(e,t){return-1==t.indexOf(e)}}getPositions(e,t,s){let l=0,o=[];for(let e=0;e<t;e++){let e=r();o.push(e)}return o;function i(){let t=document.createElement("div");return~e.indexOf(l)&&t.classList.add("bomb"),t.classList.add("cell"),t.classList.add("closed"),t}function r(){let e=[];for(let t=0;t<s;t++){let t=i();e.push(t),l++}return e}}getNumberColor(e){return 1==e?"lime":2==e||3==e?"orange":"skyblue"}getBombsNumber(e,t,s,l,o){let i=0;function r(e){return!!e.classList.contains("bomb")}return e+1<l&&r(s[e+1][t])&&i++,e-1>=0&&r(s[e-1][t])&&i++,t+1<o&&r(s[e][t+1])&&i++,t-1>=0&&r(s[e][t-1])&&i++,e+1<l&&t+1<o&&r(s[e+1][t+1])&&i++,e+1<l&&t-1>=0&&r(s[e+1][t-1])&&i++,e-1>=0&&t+1<o&&r(s[e-1][t+1])&&i++,e-1>=0&&t-1>=0&&r(s[e-1][t-1])&&i++,i}}class o{openCells(e){let t=e.rows,s=e.columns,l=e.positions;for(let e=0;e<t;e++)for(let o=0;o<s;o++)l[e][o].classList.contains("clicked")&&(l[e][o].classList.remove("clicked"),l[e][o].classList.remove("closed"),this.setBombsNumber(e,o,l,t,s),this.openLeftCell(e,o-1,l,t,s),this.openRightCell(e,o+1,l,t,s),this.openUpperCell(e-1,o,l,t,s),this.openLowerCell(e+1,o,l,t,s))}openLeftCell(e,t,s,l,o){if(e>=0&&t>=0&&e<l&&t<o&&this.isClosed(s[e][t]))if(s[e][t+1].classList.remove("closed"),s[e][t].classList.remove("closed"),this.isBomb(s[e][t])||this.isFlagged(s[e][t]))s[e][t].classList.add("closed"),this.setBombsNumber(e,t+1,s,l,o);else{if(s[e][t].style.backgroundColor="teal",this.setBombsNumber(e,t,s,l,o)>0)return this.openUpperCell(e-1,t,s,l,o),void this.openLowerCell(e+1,t,s,l,o);this.openUpperCell(e-1,t,s,l,o),this.openLowerCell(e+1,t,s,l,o),this.openLeftCell(e,t-1,s,l,o)}}openRightCell(e,t,s,l,o){if(e>=0&&t>=0&&e<l&&t<o&&this.isClosed(s[e][t]))if(s[e][t-1].classList.remove("closed"),s[e][t].classList.remove("closed"),this.isBomb(s[e][t])||this.isFlagged(s[e][t]))s[e][t].classList.add("closed"),this.setBombsNumber(e,t-1,s,l,o);else{if(s[e][t].style.backgroundColor="teal",this.setBombsNumber(e,t,s,l,o)>0)return this.openUpperCell(e-1,t,s,l,o),void this.openLowerCell(e+1,t,s,l,o);this.openUpperCell(e-1,t,s,l,o),this.openLowerCell(e+1,t,s,l,o),this.openRightCell(e,t+1,s,l,o)}}openUpperCell(e,t,s,l,o){if(e>=0&&t>=0&&e<l&&t<o&&this.isClosed(s[e][t]))if(s[e+1][t].classList.remove("closed"),s[e][t].classList.remove("closed"),this.isBomb(s[e][t])||this.isFlagged(s[e][t]))s[e][t].classList.add("closed"),this.setBombsNumber(e+1,t,s,l,o);else{if(s[e][t].style.backgroundColor="teal",this.setBombsNumber(e,t,s,l,o)>0)return this.openLeftCell(e,t-1,s,l,o),void this.openRightCell(e,t+1,s,l,o);this.openLeftCell(e,t-1,s,l,o),this.openRightCell(e,t+1,s,l,o),this.openUpperCell(e-1,t,s,l,o)}}openLowerCell(e,t,s,l,o){if(e>=0&&t>=0&&e<l&&t<o&&this.isClosed(s[e][t]))if(s[e-1][t].classList.remove("closed"),s[e][t].classList.remove("closed"),this.isBomb(s[e][t])||this.isFlagged(s[e][t]))s[e][t].classList.add("closed"),this.setBombsNumber(e-1,t,s,l,o);else{if(s[e][t].style.backgroundColor="teal",this.setBombsNumber(e,t,s,l,o)>0)return this.openLeftCell(e,t-1,s,l,o),void this.openRightCell(e,t+1,s,l,o);this.openLeftCell(e,t-1,s,l,o),this.openRightCell(e,t+1,s,l,o),this.openLowerCell(e+1,t,s,l,o)}}isClosed(e){return!!e.classList.contains("closed")}isBomb(e){return!!e.classList.contains("bomb")}isFlagged(e){return!!e.classList.contains("flagged")}setBombsNumber(e,t,s,o,i){let r=new l,n=r.getBombsNumber(e,t,s,o,i);return n>0&&(s[e][t].style.color=r.getNumberColor(n),s[e][t].innerHTML=`<p>${n}</p>`),n}}class i{static setFlags(e,t){let s=document.querySelector(".flags-left");e>=0&&e<=t&&(s.innerHTML=e)}static getFlags(){return document.querySelector(".flags-left").innerHTML}}class r{constructor(e="300px",t="150px",s="Default title",l="modal"){this.width=e,this.height=t,this.title=s,this.className=l,this.tuned=!1,this.showed=!1,this.backdrop=document.querySelector(".backdrop"),this.modal=document.querySelector(`.${this.className}`)}tune(){document.querySelector(`.${this.className}__header h1`).innerHTML=this.title,this.modal.style.width=this.width,this.modal.style.height=this.height;let e=document.documentElement.clientWidth/2-parseInt(this.width)/2+"px";this.modal.style.left=e,this.tuned=!0}show(){if(this.tuned)return this.backdrop.style.display="block",this.modal.style.display="block",void(this.showed=!0)}hide(){if(this.showed)return this.backdrop.style.display="none",this.modal.style.display="none",void(this.showed=!1)}}class n{static set(){let e=document.querySelector(".sapper__header-smile img");e.addEventListener("mousedown",()=>{~e.src.indexOf("demon")||(e.src="img/with_tongue.png")}),e.addEventListener("click",()=>{~e.src.indexOf("demon")||(e.src="img/smiling.png")}),e.addEventListener("mouseout",()=>{~e.src.indexOf("demon")||(e.src="img/smiling.png")})}static showDemon(){document.querySelector(".sapper__header-smile img").src="img/demon.png"}static showSmile(){document.querySelector(".sapper__header-smile img").src="img/smiling.png"}}class c{constructor(){c.timerMinutes=document.querySelector(".timer .timer__minutes"),c.timerSeconds=document.querySelector(".timer .timer__seconds"),c.timerId=null}static start(){let e=0,t="00";c.timerId=setInterval(()=>{60==++e&&(++t<10&&(t="0"+t),e=0);e<10&&(e="0"+e),c.timerSeconds.innerHTML=e,c.timerMinutes.innerHTML=t},1e3)}static stop(){c.timerId&&clearInterval(c.timerId)}static clear(){c.timerSeconds.innerHTML="00",c.timerMinutes.innerHTML="00"}}var a={gameStart:"Начало игры!",boom:"Буууум!",win:"Победа!",settings:"Настройки",alert:"Оповещение",error:"Ошибка!"};class u{cellLeftClick(e){e.field.onclick=(t=>{let s=t.target;if(s.classList.contains("cell"))if(s.classList.contains("bomb"))s.innerHTML="<img src='img/bomb.png'>",s.style.backgroundColor="red",e.open(),this.gameOver(e);else{s.style.backgroundColor="teal",s.classList.add("clicked"),(new o).openCells(e),this.checkForWin(e)}})}cellRightClick(e){e.field.oncontextmenu=(t=>{t.preventDefault();let s=t.target;if(s.classList.contains("cell")&&s.classList.contains("closed")&&i.getFlags()>0){s.classList.add("flagged"),s.innerHTML="<img src='img/flag.png'>",s.style.backgroundColor="#e5e04a";let t=i.getFlags();i.setFlags(--t,e.bombs.length),this.checkForWin(e)}if(s.parentNode.classList.contains("flagged")){s.parentNode.classList.remove("flagged"),s.parentNode.style.backgroundColor="",s.parentNode.innerHTML="";let t=i.getFlags();i.setFlags(++t,e.bombs.length)}})}gameOver(e){n.showDemon(),c.stop();let t=new r("450px","300px",a.boom,"loss-modal");t.tune(),t.show();let s=document.querySelector(".loss-modal__buttons .restart");(new p).restartGame(s,t,e)}checkForWin(e){let t=0,s=0;for(let l=0;l<e.rows;l++)for(let o=0;o<e.columns;o++)e.positions[l][o].classList.contains("bomb")&&e.positions[l][o].classList.contains("flagged")&&t++,e.positions[l][o].classList.contains("closed")||e.positions[l][o].classList.contains("bomb")||e.positions[l][o].classList.contains("flagged")||s++;let l=e.bombs,o=e.rows*e.columns-l.length;l.length==t&&s==o&&this.win(e)}win(e){c.stop();let t=new r("550px","300px",a.win,"win-modal");t.tune(),t.show();let s=document.querySelector(".win-modal__buttons .restart"),l=document.querySelector(".win-modal__buttons .save"),o=new p;o.restartGame(s,t,e),o.saveResults(l,t,e)}}class d{constructor(){d.table=document.querySelector(".records-table"),d.backdrop=document.querySelector(".backdrop")}static show(){d.table.style.display="block",d.backdrop.style.display="block"}static hide(){d.table.style.display="none",d.backdrop.style.display="none"}static update(){let e=localStorage,t="";for(let l in e)if("string"==typeof e[l]){t+=s(l,e[l])}function s(e,t){let s="",l=t.split(" ");s+=`<div>${e}</div>`;for(let e=0;e<l.length;e++)s+=`<div>${l[e]}</div>`;return s=`<div class="records__item">${s}</div>`}!function(e){let t=document.querySelector(".records-table .records__list");t.innerHTML=e||'<div class="empty">Список пуст.</div>'}(t)}static clear(){let e=document.querySelector(".records-table .records");for(;e.children.length>0;)e.parentNode.removeChild(e.children[0])}}class m{constructor(e="300px",t="150px",s="Headline",l="Message",o="alert"){this.width=e,this.height=t,this.headline=s,this.message=l,this.type=o,this.timerId=null,this.alert=alert=document.querySelector(".alert")}show(){this.timerId&&clearTimeout(this.timerId),this.tune(),this.alert.style.display="block",this.timerId=setTimeout(()=>{this.hide()},3e3)}tune(){let e=this.alert.querySelector(".alert__headline"),t=this.alert.querySelector(".alert__message p");this.alert.style.width=this.width,this.alert.style.height=this.height;let s=function(e){return"alert"==e}(this.type)?'<img src="./img/ok.png" />':'<img src="./img/error.png" />';e.innerHTML=`${s}<p>${this.headline}</p>`,t.innerHTML=`${this.message}`}hide(){this.alert.style.display="none"}setMessage(e){this.message=e}}class h{static checkForGameStarting(){let e=document.querySelector(".start-modal__inputs .nick-name"),t=document.querySelector(".start-modal__inputs .bombs-amount"),s=document.querySelector(".start-modal__inputs .rows"),l=document.querySelector(".start-modal__inputs .columns"),o=new m("300px","120px",a.error,"","error");return!!(function(e){if(e.value.length<1)return o.setMessage("Не заполнено имя!"),o.show(),!1;if(e.value.length>20)return o.setMessage("Максимальный размер имени 20 симоволов."),o.show(),!1;return!0}(e)&&function(e,t){if(e.value.length<0||t.value.length<0)return o.setMessage("Не заполнен размер поля!"),o.show(),!1;if(e.value<5||t.value<5)return o.setMessage("Минимальный размер поля 5х5!"),o.show(),!1;if(e.value>20||t.value>20)return o.setMessage("Максимальный размер поля 20х20!"),o.show(),!1;return!0}(s,l)&&function(e,t,s){if(e.value.length<0)return o.setMessage("Не заполнено количество бомб!"),o.show(),!1;if(e.value<1)return o.setMessage("Должна быть хотя бы одна бомба!"),o.show(),!1;let l=Math.round(t.value*s.value*.7);if(e.value>l)return o.setMessage(`Максимальное количество бомб: ${l}`),o.show(),!1;return!0}(t,s,l))}static checkNumberInput(e){e.onkeydown=(e=>{let t=e.keyCode;190!=t&&110!=t&&188!=t||e.preventDefault()})}}class p{menuToggle(e){let t=document.querySelector(".menu-list");t.style.display="none",e.onclick=function(){t.style.display="none"==t.style.display?"block":"none"}}resetGame(e,t){e.onclick=(()=>{let e=new r("500px","500px",a.settings,"start-modal");e.tune(),e.show();let s=document.querySelector(".start-modal__buttons .start");this.startGame(s,e,t)})}startGame(e,t,s){let l=new m("250px","100px",a.alert,"Новая игра.","alert");e.onclick=(()=>{if(h.checkForGameStarting()){t&&t.hide(),this.hideMenu(),n.showSmile();let e=this.getGameSettings();s.hide(),s.clear(),s.setSettings(e.rows,e.columns,e.bombsAmount),s.draw(),c.stop(),c.clear(),c.start(),i.setFlags(s.bombs.length,s.bombs.length);let o=new u;o.cellLeftClick(s),o.cellRightClick(s),l.show()}})}restartGame(e,t,s){let l=new m("250px","100px",a.alert,"Новая игра.","alert");e.onclick=(()=>{t&&t.hide(),this.hideMenu(),n.showSmile();let e=this.getGameSettings();s.hide(),s.clear(),s.setSettings(e.rows,e.columns,e.bombsAmount),s.draw(),c.stop(),c.clear(),c.start(),i.setFlags(s.bombs.length,s.bombs.length);let o=new u;o.cellLeftClick(s),o.cellRightClick(s),l.show()})}showRecordsTable(e){e.onclick=(()=>{d.update(),d.show(),this.hideMenu()})}closeRecordsTable(e){e.onclick=(()=>{d.hide()})}clearRecords(e){let t=new m("250px","100px",a.alert,"Рекорды были очищены!","alert");e.onclick=(()=>{localStorage.clear(),this.hideMenu(),t.show()})}saveResults(e){let t=this.getGameSettings(),s=`Результат для игрока ${t.nickName} сохранен.`,l=new m("310px","130px",a.alert,s,"alert");e.onclick=(()=>{let e=document.querySelector(".timer .timer__minutes"),s=document.querySelector(".timer .timer__seconds"),o=`${`${e.innerHTML}:${s.innerHTML}`} ${`${t.rows}x${t.columns}`} ${t.bombsAmount}`;localStorage.setItem(t.nickName,o),l.show()})}hideMenu(){document.querySelector(".menu-list").style.display="none"}getGameSettings(){let e=document.querySelector(".start-modal__inputs .nick-name"),t=document.querySelector(".start-modal__inputs .bombs-amount"),s=document.querySelector(".start-modal__inputs .rows"),l=document.querySelector(".start-modal__inputs .columns");return{nickName:e.value,bombsAmount:t.value,rows:s.value,columns:l.value}}}class g{constructor(){this.field=document.querySelector(".play-field"),this.positions=[],this.bombs=[],this.isTuned=!1}setSettings(e,t,s){this.rows=e,this.columns=t,this.bombsAmount=s;let o=new l;this.bombs=o.getBombs(this.bombsAmount,this.rows,this.columns),this.positions=o.getPositions(this.bombs,this.rows,this.columns),this.field.style.width=27*(this.columns-1)+30+"px",this.isTuned=!0}draw(){if(this.isTuned){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.field.appendChild(this.positions[e][t]);this.field.style.display="flex"}else;}open(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.positions[e][t].classList.contains("bomb")?(this.positions[e][t].innerHTML="<img src='img/bomb.png'>",this.positions[e][t].style.backgroundColor="red"):this.positions[e][t].style.backgroundColor="teal"}hide(){return!!this.isTuned&&(this.field.style.display="none",!0)}clear(){if(this.isTuned){for(;this.field.children.length>0;)this.field.removeChild(this.field.children[0]);return!0}return!1}}!function(){let e=new r("500px","500px",a.gameStart,"start-modal");e.tune(),e.show(),n.set();let t=new p,s=(new d,new g);new c,function(e,t){let s=document.querySelector(".menu-list .restart"),l=document.querySelector(".menu-list .reset"),o=document.querySelector(".menu-list .show-records"),i=document.querySelector(".table-close"),r=document.querySelector(".menu-list .clear-records");t.restartGame(s,null,e),t.resetGame(l,e),t.showRecordsTable(o),t.closeRecordsTable(i),t.clearRecords(r)}(s,t),function(){let e=document.querySelector(".start-modal__inputs .rows"),t=document.querySelector(".start-modal__inputs .columns"),s=document.querySelector(".start-modal__inputs .bombs-amount");h.checkNumberInput(e),h.checkNumberInput(t),h.checkNumberInput(s)}();let l=document.querySelector(".start-modal__buttons .start"),o=document.querySelector(".menu");t.startGame(l,e,s),t.menuToggle(o)}()}]);